
<!DOCTYPE html>

<html lang="pl">
<head>
<meta charset="utf-8"/>
<title>OC INWENTARYZACJA ‚Äî Proponowana Ilo≈õƒá</title>
<style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to right, #f0f4f8, #dbeafe);
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #0d47a1;
      font-size: 26px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 12px rgba(0,0,0,0.05);
    }
    th, td {
      padding: 14px;
      text-align: center;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #2196f3;
      color: white;
    }
    .qty-cell {
      font-size: 18px;
      font-weight: bold;
    }
    .proposed-box {
      border: 1px solid #2196f3;
      padding: 6px 10px;
      margin-top: 6px;
      border-radius: 6px;
      background: #e3f2fd;
      font-size: 14px;
    }
    .proposed-box span {
      font-weight: bold;
      font-size: 18px;
      color: #0d47a1;
    }
    button {
      border: none;
      padding: 6px 10px;
      margin: 2px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    .plus { background-color: #4caf50; color: white; }
    .minus { background-color: #f44336; color: white; }
    .confirm { background-color: #2196f3; color: white; }
    .reset { background-color: #9e9e9e; color: white; }
    @keyframes pulse {
      0% { background-color: #e3f2fd; }
      50% { background-color: #bbdefb; }
      100% { background-color: #e3f2fd; }
    }
    .pulse {
      animation: pulse 0.6s ease;
    }
  

.proposed-box.add {
  background: #e8f5e9;
  border: 1px solid #4caf50;
}
.proposed-box.sub {
  background: #ffebee;
  border: 1px solid #c62828;
}
</style>
</head>
<body>
<h1>OC INWENTARYZACJA ‚Äî Proponowana Ilo≈õƒá</h1>
<table>
<thead>
<tr>
<th>MODEL</th>
<th>ILO≈öƒÜ</th>
<th>EDYCJA</th>
</tr>
</thead>
<tbody>
<tr>
<td>SM-A4</td>
<td>
<div class="qty-cell" id="qty-0">367</div>
<div class="proposed-box" id="proposed-wrapper-0">
            üü¶ <strong>DO DODANIA:</strong>
<span id="proposed-0">0</span>
</div>
</td>
<td>
<button class="minus" onclick="changeQty(0, -1)">‚ûñ</button>
<button class="plus" onclick="changeQty(0, 1)">‚ûï</button>
<button class="confirm" onclick="setQty(0)">‚úîÔ∏è</button>
<button class="reset" onclick="resetQty(0)">‚úñÔ∏è</button>
</td>
</tr>
<tr>
<td>F70</td>
<td>
<div class="qty-cell" id="qty-1">34</div>
<div class="proposed-box" id="proposed-wrapper-1">
            üü¶ <strong>DO DODANIA:</strong>
<span id="proposed-1">0</span>
</div>
</td>
<td>
<button class="minus" onclick="changeQty(1, -1)">‚ûñ</button>
<button class="plus" onclick="changeQty(1, 1)">‚ûï</button>
<button class="confirm" onclick="setQty(1)">‚úîÔ∏è</button>
<button class="reset" onclick="resetQty(1)">‚úñÔ∏è</button>
</td>
</tr>
<tr>
<td>QVN01</td>
<td>
<div class="qty-cell" id="qty-2">124</div>
<div class="proposed-box" id="proposed-wrapper-2">
            üü¶ <strong>DO DODANIA:</strong>
<span id="proposed-2">0</span>
</div>
</td>
<td>
<button class="minus" onclick="changeQty(2, -1)">‚ûñ</button>
<button class="plus" onclick="changeQty(2, 1)">‚ûï</button>
<button class="confirm" onclick="setQty(2)">‚úîÔ∏è</button>
<button class="reset" onclick="resetQty(2)">‚úñÔ∏è</button>
</td>
</tr>
</tbody>
</table>
<script>
    const proposedQtyMap = {};

    
    function changeQty(index, delta) {
      if (!proposedQtyMap[index]) proposedQtyMap[index] = 0;
      proposedQtyMap[index] += delta;
      const el = document.getElementById(`proposed-${index}`);
      const box = document.getElementById(`proposed-wrapper-${index}`);
      if (proposedQtyMap[index] < 0) proposedQtyMap[index] = 0;
      if (el && box) {
        el.textContent = proposedQtyMap[index];
        box.classList.add("pulse");
        setTimeout(() => box.classList.remove("pulse"), 600);
        if (proposedQtyMap[index] > 0) {
          box.className = "proposed-box add";
          box.innerHTML = 'üü¢ <strong>DO DODANIA:</strong> <span id="proposed-' + index + '">' + proposedQtyMap[index] + '</span>';
        } else {
          box.className = "proposed-box sub";
          box.innerHTML = 'üî¥ <strong>DO ODJƒòCIA:</strong> <span id="proposed-' + index + '">' + proposedQtyMap[index] + '</span>';
        }
      }
    }
      }
    }

    function resetQty(index) {
      proposedQtyMap[index] = 0;
      const el = document.getElementById(`proposed-${index}`);
      if (el) el.textContent = "0";
    }

    function setQty(index) {
      const qtyEl = document.getElementById(`qty-${index}`);
      const current = parseInt(qtyEl.textContent);
      const add = proposedQtyMap[index] || 0;
      const finalQty = current + add;
      qtyEl.textContent = finalQty;
      proposedQtyMap[index] = 0;
      const el = document.getElementById(`proposed-${index}`);
      if (el) el.textContent = "0";
    }
  
const apiUrl = "https://wispy-waterfall-e267.lukaszarmiajotpe.workers.dev/";
const postUrl = "https://script.google.com/macros/s/AKfycbxe4JpyDE_TG2tjMHfZDnyrh6_Mr_SLHK_pvqf07gwNLde_rHDFGMEaBKnKt0tfj4SBUQ/exec";
let currentData = [];

async function loadData() {
  const res = await fetch(apiUrl);
  const data = await res.json();
  currentData = data;
  renderTable(data);
}

function renderTable(data) {
  const tableBody = document.getElementById("table-body");
  tableBody.innerHTML = "";
  data.forEach((row, index) => {
    let html = `<tr id="row-${index}">`;
    html += `<td>${row["MODEL"]}</td>`;
    html += `<td>${row["PN"]}</td>`;
    html += `<td>
      <div><span id="qty-${index}">${row["ILO≈öƒÜ"]}</span></div>
      <div class="proposed-box sub" id="proposed-wrapper-${index}">
        üî¥ <strong>DO ODJƒòCIA:</strong> <span id="proposed-${index}">0</span>
      </div>
    </td>`;
    html += `<td>
      <button class="minus" onclick="changeQty(${index}, -1)">‚ûñ</button>
      <button class="plus" onclick="changeQty(${index}, 1)">‚ûï</button>
      <button class="confirm" onclick="confirmQty(${index})">‚úîÔ∏è</button>
      <button class="reset" onclick="resetQty(${index})">‚úñÔ∏è</button>
    </td>`;
    html += "</tr>";
    tableBody.innerHTML += html;
  });
}

document.getElementById("modal-confirm").addEventListener("click", () => {
  const index = pendingIndex;
  const add = pendingAddQty;
  const base = parseInt(document.getElementById(`qty-${index}`).textContent);
  const finalQty = base + add;
  if (finalQty < 0) {
    alert("‚ùå Nie mo≈ºna odjƒÖƒá wiƒôcej ni≈º aktualna ilo≈õƒá!");
    document.getElementById("confirm-modal").style.display = "none";
    return;
  }
  document.getElementById(`qty-${index}`).textContent = finalQty;
  document.getElementById(`proposed-${index}`).textContent = "0";
  proposedQtyMap[index] = 0;
  document.getElementById("confirm-modal").style.display = "none";

  const row = currentData[index];
  const payload = [{
    MODEL: row["MODEL"],
    PN: row["PN"],
    ILO≈öƒÜ: finalQty,
    updated: new Date().toLocaleString()
  }];
  fetch(postUrl, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(payload)
  }).then(() => console.log("[‚úîÔ∏è] Dane wys≈Çane:", payload))
    .catch(err => console.error("‚ùå B≈ÇƒÖd zapisu:", err));
});

document.getElementById("modal-cancel").addEventListener("click", () => {
  document.getElementById("confirm-modal").style.display = "none";
  pendingIndex = null;
  pendingAddQty = 0;
});

loadData();
</script>
<div id="confirm-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; align-items:center; justify-content:center;">
<div style="background:white; padding:20px 30px; border-radius:10px; text-align:center; box-shadow:0 0 10px rgba(0,0,0,0.3);">
<p style="font-size:16px; font-weight:bold; color:#e65100;">‚ùó Czy na pewno chcesz dodaƒá <span id="modal-qty">X</span> sztuk?</p>
<div style="margin-top: 15px;">
<button id="modal-confirm" style="background:#4caf50; color:white; padding:6px 14px; border:none; border-radius:6px; margin-right:10px;">Tak</button>
<button id="modal-cancel" style="background:#f44336; color:white; padding:6px 14px; border:none; border-radius:6px;">Anuluj</button>
</div>
</div>
</div>
<script>
  let pendingIndex = null;
  let pendingAddQty = 0;

  document.getElementById("modal-confirm").addEventListener("click", () => {
    document.getElementById("confirm-modal").style.display = "none";
    const qtyEl = document.getElementById(`qty-${pendingIndex}`);
    const current = parseInt(qtyEl.textContent);
    const finalQty = current + pendingAddQty;
    qtyEl.textContent = finalQty;
    proposedQtyMap[pendingIndex] = 0;
    const el = document.getElementById(`proposed-${pendingIndex}`);
    if (el) el.textContent = "0";
    pendingIndex = null;
    pendingAddQty = 0;
  });

  document.getElementById("modal-cancel").addEventListener("click", () => {
    document.getElementById("confirm-modal").style.display = "none";
    pendingIndex = null;
    pendingAddQty = 0;
  });

  function setQty(index) {
    const add = proposedQtyMap[index] || 0;
    if (add <= 0) return;
    document.getElementById("modal-qty").textContent = add;
    document.getElementById("confirm-modal").style.display = "flex";
    pendingIndex = index;
    pendingAddQty = add;
  }
</script>
</body>
</html>
